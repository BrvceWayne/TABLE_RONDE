<div class="restaurants">

  <%# Header avec logo %>
  <header class="restaurants__header">
    <%= link_to root_path, class: "restaurants__logo" do %>
      <span class="restaurants__logo-left">TableR</span>
      <span class="restaurants__logo-icon">
        <span class="restaurants__logo-circle"></span>
        <span class="restaurants__logo-fork"></span>
        <span class="restaurants__logo-knife"></span>
      </span>
      <span class="restaurants__logo-right">nde</span>
    <% end %>
  </header>

  <%# Titre %>
  <div class="restaurants__title">
    <span class="restaurants__title-icon">ğŸ‰</span>
    <h1 class="restaurants__title-text">Nos recommandations</h1>
    <p class="restaurants__subtitle">BasÃ©es sur les prÃ©fÃ©rences de tous les participants</p>
  </div>

  <%# Carousel 3D %>
  <div class="carousel" data-controller="carousel">
    <div class="carousel__stage">

      <% @restaurants.sort_by(&:rank).each do |restaurant| %>
        <article class="carousel__card" data-carousel-target="card">
          <div class="restaurant-card <%= 'restaurant-card--featured' if restaurant.rank == 1 %>">

            <% if restaurant.rank == 1 %>
              <%# Particules d'Ã©toiles autour du winner %>
              <div class="restaurant-card__particles">
                <% 12.times do |i| %>
                  <span class="restaurant-card__particle restaurant-card__particle--<%= i + 1 %>"></span>
                <% end %>
              </div>
              <div class="restaurant-card__glow"></div>
            <% end %>

            <%# Badge %>
            <div class="restaurant-card__badge">
              <span class="restaurant-card__rank <%= restaurant.rank == 1 ? 'restaurant-card__rank--winner' : 'restaurant-card__rank--alternative' %>">
                <%= restaurant.rank == 1 ? 'ğŸ†' : "##{restaurant.rank}" %>
              </span>
            </div>

            <%# Header %>
            <div class="restaurant-card__header">
              <% if restaurant.rank == 1 %>
                <span class="restaurant-card__winner-label">
                  <span>â­</span> Notre meilleur choix
                </span>
              <% end %>
              <h2 class="restaurant-card__name"><%= restaurant.name %></h2>
              <p class="restaurant-card__address">
                <span class="restaurant-card__address-icon">ğŸ“</span>
                <span><%= restaurant.address %></span>
              </p>
            </div>

            <%# Body %>
            <div class="restaurant-card__body">
              <div class="restaurant-card__explanation">
                <%= restaurant.ai_explanation %>
              </div>

              <% if restaurant.phone.present? %>
                <div class="restaurant-card__phone">
                  <span>ğŸ“</span>
                  <%= link_to restaurant.phone, "tel:#{restaurant.phone}" %>
                </div>
              <% end %>
            </div>

          </div>
        </article>
      <% end %>

    </div>

    <%# Navigation %>
    <button class="carousel__nav carousel__nav--prev" data-carousel-target="prev" data-action="click->carousel#prev">
      <span>â€¹</span>
    </button>
    <button class="carousel__nav carousel__nav--next" data-carousel-target="next" data-action="click->carousel#next">
      <span>â€º</span>
    </button>

    <%# Dots %>
    <div class="carousel__dots"></div>
  </div>

  <%# Actions %>
  <section class="restaurants__actions">
    <%= link_to dashboard_session_path(share_code: @session.share_code), class: "restaurants__btn restaurants__btn--secondary" do %>
      <span>â†</span> Retour au dashboard
    <% end %>

    <%= button_to regenerate_session_restaurants_path(session_share_code: @session.share_code),
        method: :post,
        class: "restaurants__btn restaurants__btn--warning",
        data: { turbo: false } do %>
      <span>ğŸ”„</span> Nouvelles recommandations
    <% end %>
  </section>

</div>
