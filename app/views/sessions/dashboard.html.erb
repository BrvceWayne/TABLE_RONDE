<div class="dashboard" data-controller="auto-refresh" data-auto-refresh-interval-value="5000">

  <%# Header avec logo %>
  <header class="dashboard__header">
    <%= link_to root_path, class: "dashboard__logo" do %>
      <span class="dashboard__logo-left">TableR</span>
      <span class="dashboard__logo-icon">
        <span class="dashboard__logo-circle"></span>
        <span class="dashboard__logo-fork"></span>
        <span class="dashboard__logo-knife"></span>
      </span>
      <span class="dashboard__logo-right">nde</span>
    <% end %>
  </header>

  <div class="dashboard__content">

    <%# Section code de partage (leader only) %>
    <% if @is_leader %>
      <section class="dashboard__share">
        <p class="dashboard__share-label">Partagez ce code avec vos amis</p>
        <div class="dashboard__code">
          <% @session.share_code.chars.each do |char| %>
            <span class="dashboard__code-digit"><%= char %></span>
          <% end %>
        </div>
        <button class="dashboard__copy-btn"
                data-controller="clipboard"
                data-action="click->clipboard#copy"
                data-clipboard-text-value="<%= join_session_url(@session.share_code) %>">
          <span class="dashboard__copy-icon">ğŸ“‹</span>
          <span class="dashboard__copy-text">Copier le lien</span>
        </button>
      </section>
    <% end %>

    <%# Info repas %>
    <div class="dashboard__meal-badge">
      <% meal_icons = { 'Petit-dÃ©jeuner' => 'ğŸ¥', 'Brunch' => 'â˜€ï¸', 'DÃ©jeuner' => 'ğŸ½ï¸', 'DÃ®ner' => 'ğŸŒ™' } %>
      <span class="dashboard__meal-icon"><%= meal_icons[@session.meal_type] || 'ğŸ´' %></span>
      <span class="dashboard__meal-type"><%= @session.meal_type %></span>
    </div>

    <%# Section participants %>
    <section class="dashboard__participants">
      <h2 class="dashboard__section-title">
        Participants
        <span class="dashboard__count"><%= @participants_status.size %></span>
      </h2>

      <div class="dashboard__participants-grid">
        <% @participants_status.each do |p| %>
          <div class="dashboard__participant-card <%= 'dashboard__participant-card--completed' if p[:preferences_completed] %>">
            <div class="dashboard__participant-avatar">
              <%= p[:user].guest? ? 'ğŸ‘¤' : p[:user].email[0].upcase %>
            </div>
            <div class="dashboard__participant-info">
              <span class="dashboard__participant-name">
                <%= p[:user].guest? ? "InvitÃ©" : p[:user].email.split('@').first %>
              </span>
              <% if p[:leader] %>
                <span class="dashboard__participant-role">Leader</span>
              <% end %>
            </div>
            <div class="dashboard__participant-status">
              <% if p[:preferences_completed] %>
                <span class="dashboard__status-badge dashboard__status-badge--success">âœ“</span>
              <% else %>
                <span class="dashboard__status-badge dashboard__status-badge--pending">
                  <span class="dashboard__hourglass">â³</span>
                </span>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </section>

    <%# Actions %>
    <section class="dashboard__actions">
      <% if @is_participant %>
        <%= link_to new_session_preference_path(session_share_code: @session.share_code), class: "dashboard__btn dashboard__btn--secondary" do %>
          <span>ğŸ“</span> Mes prÃ©fÃ©rences
        <% end %>
      <% else %>
        <%= link_to join_session_path(@session.share_code), class: "dashboard__btn dashboard__btn--secondary" do %>
          <span>â•</span> Rejoindre
        <% end %>
      <% end %>

      <% if @is_leader %>
        <%= button_to generate_recommendations_session_path(share_code: @session.share_code),
            method: :post,
            class: "dashboard__btn dashboard__btn--primary",
            data: { turbo: false } do %>
          <span>âœ¨</span> GÃ©nÃ©rer les restos
        <% end %>
      <% elsif @session.restaurants.any? %>
        <%= link_to session_restaurants_path(session_share_code: @session.share_code), class: "dashboard__btn dashboard__btn--primary" do %>
          <span>ğŸ´</span> Voir les restos
        <% end %>
      <% else %>
        <div class="dashboard__waiting">
          <span class="dashboard__waiting-icon">â³</span>
          <span>En attente du leader...</span>
        </div>
      <% end %>
    </section>

  </div>
</div>
